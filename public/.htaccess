# CRITICAL: These rules MUST be at the very top
RewriteEngine On

# Handle real files first - DO NOT rewrite them
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Handle real directories first - DO NOT rewrite them  
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# SPA routing - only for non-existent files/directories
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]

# MIME types for static assets
<IfModule mod_mime.c>
    AddType application/javascript .js
    AddType text/css .css
    AddType image/png .png
    AddType image/jpeg .jpg .jpeg
    AddType image/gif .gif
    AddType image/x-icon .ico
    AddType image/svg+xml .svg
    AddType font/woff .woff
    AddType font/woff2 .woff2
    AddType font/ttf .ttf
    AddType font/eot .eot
</IfModule>

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"