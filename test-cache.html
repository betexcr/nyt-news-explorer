<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Cache Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        img { max-width: 100%; height: auto; margin: 10px 0; }
        .status { padding: 10px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Image Cache Test for NYT News Explorer</h1>
    
    <div class="test-section">
        <h2>Test Images from https://nyt.brainvaultdev.com</h2>
        <p>These images should load from cache on refresh:</p>
        
        <div>
            <h3>Hero Image (Original)</h3>
            <img src="https://nyt.brainvaultdev.com/home-hero.jpg" alt="Hero Image" id="hero-img">
            <div class="status info">Loading from: <span id="hero-source">Loading...</span></div>
        </div>
        
        <div>
            <h3>Hero Image (800px)</h3>
            <img src="https://nyt.brainvaultdev.com/home-hero-800.jpg" alt="Hero 800px" id="hero-800-img">
            <div class="status info">Loading from: <span id="hero-800-source">Loading...</span></div>
        </div>
        
        <div>
            <h3>Hero Image (1200px)</h3>
            <img src="https://nyt.brainvaultdev.com/home-hero-1200.jpg" alt="Hero 1200px" id="hero-1200-img">
            <div class="status info">Loading from: <span id="hero-1200-source">Loading...</span></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Cache Test Controls</h2>
        <button onclick="testCache()">Test Cache Status</button>
        <button onclick="clearCache()">Clear Browser Cache</button>
        <button onclick="reloadImages()">Reload Images</button>
        <button onclick="location.reload()">Refresh Page</button>
    </div>
    
    <div class="test-section">
        <h2>Instructions</h2>
        <ol>
            <li>Load this page and wait for images to load</li>
            <li>Click "Refresh Page" - images should load instantly from cache</li>
            <li>Check browser DevTools Network tab to see cache hits</li>
            <li>Look for "from memory cache" or "from disk cache" in Network tab</li>
        </ol>
    </div>

    <script>
        function updateImageSource(imgId, sourceId) {
            const img = document.getElementById(imgId);
            const source = document.getElementById(sourceId);
            
            img.onload = function() {
                source.textContent = 'Loaded successfully';
                source.className = 'status success';
            };
            
            img.onerror = function() {
                source.textContent = 'Failed to load';
                source.className = 'status error';
            };
        }
        
        function testCache() {
            const images = ['hero-img', 'hero-800-img', 'hero-1200-img'];
            images.forEach(imgId => {
                const img = document.getElementById(imgId);
                const start = performance.now();
                
                img.onload = function() {
                    const end = performance.now();
                    const loadTime = end - start;
                    const source = document.getElementById(imgId.replace('-img', '-source'));
                    
                    if (loadTime < 10) {
                        source.textContent = `Loaded from cache (${loadTime.toFixed(2)}ms)`;
                        source.className = 'status success';
                    } else {
                        source.textContent = `Loaded from network (${loadTime.toFixed(2)}ms)`;
                        source.className = 'status info';
                    }
                };
                
                // Trigger reload
                img.src = img.src + '?t=' + Date.now();
            });
        }
        
        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                    alert('Cache cleared! Reload the page to test fresh loading.');
                });
            } else {
                alert('Cache API not available. Use browser settings to clear cache.');
            }
        }
        
        function reloadImages() {
            const images = ['hero-img', 'hero-800-img', 'hero-1200-img'];
            images.forEach(imgId => {
                const img = document.getElementById(imgId);
                img.src = img.src.split('?')[0] + '?t=' + Date.now();
            });
        }
        
        // Initialize
        updateImageSource('hero-img', 'hero-source');
        updateImageSource('hero-800-img', 'hero-800-source');
        updateImageSource('hero-1200-img', 'hero-1200-source');
    </script>
</body>
</html>
